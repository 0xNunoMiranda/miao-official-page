---
deployment:
  tasks:
    # 1) Verificar se estamos no diret√≥rio correto
    - /bin/pwd
    
    # 2) Confirmar que √© projeto Node.js (n√£o Python)
    - /bin/test -f package.json || (echo "ERROR: package.json n√£o encontrado" && exit 1)
    - /bin/test ! -f requirements.txt || (echo "ERROR: Este √© um projeto Node.js, n√£o Python" && exit 1)
    
    # 3) Limpar builds anteriores
    - /bin/rm -rf .next node_modules/.cache || true
    
    # 4) Instalar depend√™ncias Node.js
    - /bin/npm ci || /bin/npm install
    
    # 5) Verificar Node.js est√° dispon√≠vel
    - /usr/bin/node --version || (echo "ERROR: Node.js n√£o encontrado" && exit 1)
    - /usr/bin/npm --version || (echo "ERROR: npm n√£o encontrado" && exit 1)
    
    # 6) Build de produ√ß√£o (Next.js)
    - /bin/npm run build
    
    # 7) Verificar se o build foi bem-sucedido
    - /bin/test -d .next || (echo "Build failed: .next directory not found" && exit 1)
    
    # 8) Garantir permiss√µes corretas
    - /bin/chmod -R 755 .next || true
    - /bin/chmod -R 755 public || true
    
    # 9) Mensagem final
    - echo "‚úÖ Deploy Next.js conclu√≠do com sucesso!"
    - echo "üì¶ Projeto Node.js detectado e buildado corretamente"
